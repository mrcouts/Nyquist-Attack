\subsection{Control}\label{S03-2}
 
\noindent {\bf Controle por modos deslizantes}\\

Nesta se\c{c}\~ao ser\'a feita uma breve introdu\c{c}\~ao ao controle por modos deslizantes. O tema ser\'a explorado apenas para o controle de sistemas de segunda ordem, sem incertezas param\'etricas, para n\~ao fugir do escopo do cap\'itulo. \\

Seja um sistema din\^amico dado pela seguinte equa\c{c}\~ao diferencial:
\begin{equation} \label{eq:SimpleODE}
\ddot{x} = u
\end{equation}

Definimos a seguinte superf\'icie, chamada de superf\'icie de escorregamento:
\begin{equation} \label{eq:SlidingSurface}
s(e, \dot{e}) = - (\dot{e} + \lambda e) = 0, \, \lambda > 0
\end{equation}

Sendo $e = x_d - x$ o erro de controle e $x_d$ o sinal de refer\^encia. Repare que se o sistema estiver na superf\'icie de escorregamento, temos:
\begin{equation} \label{eq:SlidingError}
\dot{e} + \lambda e = 0 \Rightarrow e(t) = C e^{- \lambda t}
\end{equation}

Sendo assim, o erro cai exponencialmente para zero, com constante de tempo $1/\lambda$.

Para encontrar a lei de controle que leva o sistema \`a superf\'icie de escorregamento, parte-se da defini\c{c}\~ao de $s$:

$ s = -(\dot{e} + \lambda e) $ \\

Derivando no tempo:
\begin{equation} \label{eq:dotS}
\dot{s} =  -(\ddot{e} + \lambda \dot{e}) = \ddot{x} - \ddot{x}_d - \lambda \dot{e} 
\end{equation}

Substituindo \eqref{eq:SimpleODE} em \eqref{eq:dotS}:
\begin{equation} \label{dotS2}
\dot{s} = u - \ddot{x}_d - \lambda \dot{e}
\end{equation}

Utizando a seguinte lei de controle:
\begin{equation} \label{SMControlLaw1D}
u = \ddot{x}_d + \lambda \dot{e} - k \sign (s), \, k>0
\end{equation}

Temos:
\begin{equation} \label{CloserLoop1D}
\dot{s} = -k \sign(s) 
\end{equation}

Supondo que o sistema come\c{c}a em $s(0) = s_0 >0$. Resolvendo a EDO para $s>0$:

$$ \dot{s} = -k \Rightarrow s = -k t + C $$
$$ s(0) = s_0 \Rightarrow C = s_0 $$
$$ \therefore s = s_0 - k t, \, s>0 $$

Em $t = t_s = \frac{|s_0|}{k}$, $s$ chega em zero. Resolvendo a EDO para $s(t_s) = 0$:

$$ \dot{s} = 0 \Rightarrow s =  C $$
$$ s(t_s) = 0 \Rightarrow C = 0 $$

Portanto, para a solu\c{c}\~ao da EDO para $s(0) = s_0 > 0$ é
\begin{equation} \label{eq:SM-ODE-Sol1}
s(t) =
\begin{cases}
s_0 - k t, \, t < t_s \\
0, \,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, t \geq t_s \\
\end{cases}
\end{equation}

Resolvendo para $s(0) = s_0 < 0$, temos um resultado an\'alogo:

\begin{equation} \label{eq:SM-ODE-Sol2}
s(t) =
\begin{cases}
s_0 + k t, \, t < t_s \\
0, \,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, t \geq t_s \\
\end{cases}
\end{equation}

Assim, pode-se concluir que a EDO \eqref{CloserLoop1D} converge para $s=0$, independente da condi\c{c}\~ao inicial. Portanto, temos que a lei de controle \eqref{SMControlLaw1D} faz com que o sistema representado por \eqref{eq:SimpleODE} siga o sinal de refer\^encia, pois o erro de controle converge para zero. \\

\noindent {\bf Controle por modos deslizantes extendido}\\

Como foi visto na se\c{c}\~ao de modelagem, \'e muito conveniente utilizar coordenadas redundantes para realizar a modelagem de mecanismos paralelos. Sendo assim, propomos nesta se\c{c}\~ao uma lei de controle para sistemas descritos por coordenadas redundantes. \\
 
O modelo de um sistema mec\^anico multi-corpos pode ser descrito de maneira gen\'erica pelas seguintes equa\c{c}\~oes:
\begin{equation} \label{eq:MechanicalSystem}
\begin{cases}
\mC_n^\top (\mq_n) \Big( \mM_n (\mq_n) \ddot{\mq}_n + \mw_n (\mq_n, \dot{\mq}_n) + \mz_n (\mq_n) \Big) = \mu_n \\
\mA_n \ddot{\mq}_n + \mb_n (\mq_n, \dot{\mq}_n) = \mzr
\end{cases}
\end{equation}

De maneira matricial compacta:
\begin{equation} \label{eq:MechanicalSystemMatrix}
\begin{bmatrix}
\mC_n^\top \mM_n \\
\mA_n
\end{bmatrix}
\ddot{\mq}_n
=
\begin{bmatrix}
\mu_n - \mC_n^\top(\mw_n + \mz_n) \\
-\mb_n
\end{bmatrix}
\end{equation}

Gostaria que $ \ddot{\mq}_n = \mv_n $, sendo $\mv_n$ uma entrada de controle. Para que isso aconte\c{c}a, utilizamos a seguinte lei de controle:
\begin{equation} \label{eq:ControlLawV}
\mu_n = \mC_n^\top ( \mM_n \mv_n + \mw_n + \mz_n )
\end{equation}

Como queremos que $ \ddot{\mq}_n = \mv_n $ e $\ddot{\mq}_n$ tem restri\c{c}\~oes, $\mv_n$ deve respeitar as mesmas restri\c{c}\~oes, ou seja:
\begin{equation} \label{eq:ControlLawVRestriction}
\mA_n \mv_n + \mb_n = \mzr
\end{equation}

Aplicando a lei de controle \eqref{eq:ControlLawV} e a restri\c{c}\~ao \eqref{eq:ControlLawVRestriction} em \eqref{eq:MechanicalSystemMatrix}, temos: \\

$ \begin{bmatrix}
\mC_n^\top \mM_n \\
\mA_n
\end{bmatrix}
\ddot{\mq}_n
=
\begin{bmatrix}
\mC_n^\top ( \mM_n \mv_n + \mw_n + \mz_n ) - \mC_n^\top(\mw_n + \mz_n) \\
\mA_n \mv_n
\end{bmatrix}
=
\begin{bmatrix}
\mC_n^\top  \mM_n \mv_n \\
\mA_n \mv_n
\end{bmatrix}
=
\begin{bmatrix}
\mC_n^\top \mM_n \\
\mA_n
\end{bmatrix}
\mv_n $

\begin{equation} \label{eq:ClosedLoopV}
\therefore \ddot{\mq}_n = \mv_n
\end{equation}

Seja $\mv'_n$ dado pela lei de controle por modos deslizantes:
\begin{equation} \label{eq:SMControlowLasV1'}
\mv'_n = \ddot{\mq}_{n, d} + \lambda \dot{\me}_n + k \sign (\dot{\me}_n + \lambda \me_n)
\end{equation}
Sendo $ \me_n = \mq_{n,d} - \mq_n $ o erro de controle e $\mq_{n,d}$ o sinal de refer\^encia. Se n\~ao houvesse restri\c{c}\~oes, poderiamos fazer $ \mv_n = \mv'_n $ :
$$ \ddot{\mq}_n = \mv_n \Rightarrow  \ddot{\me}_n + \lambda \dot{\me}_n + k \sign (\dot{\me}_n + \lambda \me_n) = \mzr$$
Isso garantiria que $\me_n \rightarrow 0$ quando $t \rightarrow \infty$ para quaisquer condi\c{c}\~oes iniciais, como visto na se\c{c}\~ao anterior. \\

Como temos restri\c{c}\~oes em $\mv_n$, procuramos $\mv_n$ mais pr\'oximo poss\'ivel de $\mv'_n$ atraves da solu\c{c}\~ao do seguinte problema de otimiza\c{c}\~ao:
\begin{equation} \label{eq:Optimization}
\begin{aligned}
& \underset{\mv_n}{\text{Min}}
& & (\mv_n - \mv'_n)^\top \mM_n (\mv_n - \mv'_n) \\
& \text{tal que}
& & \mA_n \mv_n + \mb_n = \mzr
\end{aligned}
\end{equation}

Como $\mM_n$ \'e n\~ao-negativa definida, temos que $(\mv_n - \mv'_n)^\top \mM_n (\mv_n - \mv'_n) \geq 0 $ para qualquer valor de $\mv_n$.

Aplicando a t\'enica dos multiplicadores de Lagrange, pode-se dizer que o seguinte problema é equivalente:
\begin{equation}
\begin{aligned}
& \underset{\mv_n, \mlambda}{\text{Min}}
& & L = (\mv_n - \mv'_n)^\top \mM_n (\mv_n - \mv'_n) + (\mA_n \mv_n + \mb_n)^\top \mlambda \\
\end{aligned}
\end{equation}


Para solucionar o problema, imp\~oe-se a estacionariedade da fun\c{c}\~ao lagrangeana:

$$ \dl L = 0 \Rightarrow \dl \mv_n^\top \mM_n (\mv_n - \mv'_n) + (\mv_n - \mv'_n)^\top \mM_n \dl \mv_n + (\mA_n \dl \mv_n)^\top \mlambda + (\mA_n \mv_n + \mb_n)^\top \dl \mlambda = 0 $$
$$ \Rightarrow \dl \mv_n^\top \Big( (\mM_n + \mM_n^\top)(\mv_n - \mv'_n) + \mA_n^\top \mlambda \Big) + \dl \mlambda^\top (\mA_n \mv_n + \mb_n) = 0 $$

Como $\mM_n$ \'e sim\'etrica e $\dl \mv_n$ e $\dl \mlambda$ s\~ao arbitr\'arios, temos:
\begin{equation} \label{eq:OptimizationSol}
\begin{cases}
2 \mM_n (\mv_n - \mv'_n) + \mA_n^\top \mlambda = \mzr \\
\mA_n \mv_n + \mb_n = \mzr
\end{cases}
\end{equation}

Como $\mC_n$ é o complemento ortogonal de $\mA_n$, multiplicando a primeira equa\c{c}\~ao de \eqref{eq:OptimizationSol} por $\mC_n^\top$, temos: \\

$ 2 \mC_n^\top \mM_n (\mv_n - \mv'_n) + \mC_n^\top \mA_n^\top \mlambda = \mzr $
$ \Rightarrow  \mC_n^\top \mM_n (\mv_n - \mv'_n)  = \mzr $
\begin{equation} \label{eq:OptimizationSol2}
\therefore \mC_n^\top \mM_n \mv_n  = \mC_n^\top \mM_n  \mv'_n
\end{equation}

Sendo assim, temos que a lei de controle que torna o sistema em malha fechado o mais pr\'oximo poss\'ivel de $\ddot{\mq}_n = \mv'$, segundo o crit\'erio de otimiza\c{c}\~ao adotado, \'e:
\begin{equation} \label{eq:ControlLawFinal}
\mu_n = \mC_n^\top ( \mM_n \mv'_n + \mw_n + \mz_n )
\end{equation}

\newpage

\noindent {\bf Prova que o m\'etodo converge, n\~ao vai para o livro}\\

$$
\begin{bmatrix}
\mC^T \mM \\
\mA
\end{bmatrix}
\ddot{\mq}
=
\begin{bmatrix}
\mathbb{\zeta} \mu \\
-\mb
\end{bmatrix}
$$



$$ \mu = \mathbb{\zeta}^{-1} \mC^T \mM \mu' $$
$$ \mu' = \ddot{\mq}_d + \lambda \dot{\me} - k  \sign (\ms) $$

$$ \ms = - \dot{\me} - \lambda \me $$
$$ \dot{\ms} = - \ddot{\me} - \lambda \dot{\me} = \ddot{\mq} - \ddot{\mq}_d  - \lambda \dot{\me} $$
$$ \dot{\ms} =  \begin{bmatrix}
\mC^T \mM \\
\mA
\end{bmatrix}^{-1}
\begin{bmatrix}
\mathbb{\zeta} \mu \\
-\mb
\end{bmatrix}
 - \ddot{\mq}_d  - \lambda \dot{\me} $$
 
Aplicando a lei de controle:

$$ \dot{\ms} =  \begin{bmatrix}
\mC^T \mM \\
\mA
\end{bmatrix}^{-1}
\begin{bmatrix}
 \mC^T \mM (\ddot{\mq}_d + \lambda \dot{\me} - k  \sign (\ms)) \\
-\mb
\end{bmatrix}
 - \ddot{\mq}_d  - \lambda \dot{\me} $$
 
 $$ \dot{\ms} =  \begin{bmatrix}
\mC^T \mM \\
\mA
\end{bmatrix}^{-1}
\begin{bmatrix}
 \mC^T \mM (\ddot{\mq}_d + \lambda \dot{\me} - k  \sign (\ms)) -  \mC^T \mM(\ddot{\mq}_d  + \lambda \dot{\me}) \\
-\mb - \mA(\ddot{\mq}_d  + \lambda \dot{\me})
\end{bmatrix} $$

 $$ \dot{\ms} =  \begin{bmatrix}
\mC^T \mM \\
\mA
\end{bmatrix}^{-1}
\begin{bmatrix}
- \mC^T \mM  k  \sign (\ms) \\
-\mb - \mA(\ddot{\mq}_d  + \lambda \dot{\me})
\end{bmatrix} $$

Definindo:
$$\begin{bmatrix}
\mC^T \mM \\
\mA
\end{bmatrix}^{-1}
=
\begin{bmatrix}
(\mC^T \mM)^\dagger & \mA^\dagger
\end{bmatrix} $$

Temos:

$$\dot{\ms} = 
- (\mC^T \mM)^\dagger \mC^T \mM  k  \sign (\ms) - \mA^\dagger\mb - \mA^\dagger \mA(\ddot{\mq}_d  + \lambda \dot{\me}) $$

Sendo assim, se a seguinte inequação for respeitada para pelo menos $\nu\ssh$ componentes de $\dot{\ms}$, o erro vai a zero:

$$\dot{\ms} = 
- (\mC^T \mM)^\dagger \mC^T \mM  k  \sign (\ms) - \mA^\dagger\mb - \mA^\dagger \mA(\ddot{\mq}_d  + \lambda \dot{\me}) \leq \mzr $$